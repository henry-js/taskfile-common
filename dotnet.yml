version: "3"

vars:
  SOLUTION_FILE: '{{.SOLUTION_FILE | default "" }}'
  SRC_DIR: '{{default "src" .SRC_DIR}}'

tasks:
  # Cleans the solution
  clean:
    desc: "Runs 'dotnet clean' on the solution"
    cmds:
      - dotnet clean {{.SOLUTION_FILE}}

  # Restores NuGet packages
  restore:
    desc: "Restores NuGet packages for the solution"
    cmds:
      - dotnet restore {{.SOLUTION_FILE}}

  # Builds the solution in Release mode
  build:
    desc: "Builds the solution in Release configuration"
    deps: [restore] # Ensures packages are restored before building
    cmds:
      - dotnet build {{.SOLUTION_FILE}} -c Release --no-restore

  # Runs all tests
  test:
    desc: "Runs all tests in the solution"
    deps: [build] # Ensures the project is built before testing
    cmds:
      - dotnet test {{.SOLUTION_FILE}}

  # Publishes the executable project
  publish:
    desc: "Publishes the main project"
    deps: [clean] # Start from a clean state
    cmds:
      # The `dotnet publish` command is more specific, so projects will often
      # define their own publish task that calls this one or just use this directly
      # by setting the PROJECT_TO_PUBLISH variable.
      - dotnet publish {{.SRC_DIR}}/{{.PROJECT_TO_PUBLISH}} -c Release -o {{.OUTPUT_DIR}}
